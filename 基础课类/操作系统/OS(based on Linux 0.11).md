# 计算机操作系统

## 前言

在CSAPP中，已经初步了解过了编写的代码是如何一步步加载到内存中执行的

> 经过以下阶段
>
> - 编译，得到汇编代码
> - 汇编，得到目标文件
> - 链接，得到可执行文件
> - 加载，通过虚拟内存系统，将磁盘上的可执行文件按页映射入物理内存中
> - 执行，CPU从内存中读指令，并进行运算等操作

但是仍然不足以解释为什么能在屏幕上输出“Hello world”

这中间还差了一环，在输出时，我们**通过系统级调用**，向标准输出设备文件输出，而这一部分，就是由操作系统提供的

这门课的**目的就是理解操作系统如何运作，通过对上层提供接口，从而协调多种硬件共同工作**。

## 计算机的启动过程

### 预备知识

- 计算机在上电后，会做的第一件事就是**运行BIOS**，完成计算机内部的检查与初始化（设置一些寄存器的值等），这一过程**会将CS：IP设置为 0x07c0**，**并将磁盘中第一个扇区（每个扇区大小为512KB）读入**，这将是计算机将执行的第一个程序

- 通过汇编可以与主板上的硬件进行交互（**BIOS提供了一系列的中断操作**），用户编写的汇编代码可以通过调用中断操作硬件（操作系统也是这样协调硬件的）

- 磁盘的读取是以磁盘上的**扇区为单位进行读取**的，BIOS为磁盘读取提供了中断（INT13）

### bootsect.s

源码文件放在同一文件夹下

- BIOS执行后

![image-20220514193329533](../../_Images/image-20220514193329533.png)

- bootsect-1 复制了自己

![image-20220514193502562](../../_Images/image-20220514193502562.png)

- 读取setup

![image-20220514193835529](../../_Images/image-20220514193835529.png)

- 读system

![image-20220514194102737](../../_Images/image-20220514194102737.png)

**不难看出，bootsect只是读取了后续需要的所有文件...**